---
import { Heading, BodyShort } from "@navikt/ds-react";
import { text } from "@src/language/text";
import ClientIsland from "@src/components/ClientIsland";
import logger from "@src/utils/logger";
import { getOboToken } from "@src/utils/token";
import type { Language } from "@src/types";
import styles from "@src/styles/index.module.css";
import "@src/styles/aksel.css";

const exampleApiUrl = import.meta.env.EXAMPLE_API_URL;
let isErorr: boolean = false;

const exampleData: any = await fetch(exampleApiUrl, {
  method: "GET",
  headers: {
    "Content-Type": "application/json",
    Authorization: `Bearer ${getOboToken(Astro.locals.token)}`,
  },
})
  .then((response) => {
    if (!response.ok) {
      logger.error(`Error fetching example data: ${response.statusText} with  ${response.status}`);
      isErorr = true;
    }
    return response.json();
  })
  .catch((error) => {
    logger.error("Error fetching example data:", error);
    isErorr = true;
  });

if (isErorr) {
  return new Response("Internal Server Error", {
    status: 503,
  });
}

const language = Astro.currentLocale as Language;
---

<section class="tms-microfrontend-template-ssr">
  <div class={styles.microfrontend}>
    <Heading size="medium" level="2">
      {text.title[language]}
    </Heading>
    <BodyShort>
      {text.name[language]}: {exampleData.name}
    </BodyShort>
    <ClientIsland client:only="react" />
  </div>
</section>
